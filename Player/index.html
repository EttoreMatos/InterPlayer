<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Player de √Åudio</title>
<style>
  body{
    background: #111;
    background-size:300% 500%;
    font-family:Arial,sans-serif;
    text-align:center;
    margin-top:100px;
  }

  .container{
    display:inline-block;
    position: relative;
    width:25%;
    background:linear-gradient(45deg,#d01df0df,#1dcdf0d8);
    padding:40px;
    border-radius:20px;
    box-shadow: 3px 3px 40px #1dcdf0;
    transition:.4s;
    text-align:left;
  }
  .container:hover{width:30%;}

  #barra-progresso{
    width:100%;
    margin-top:15px;
  }
  #progresso{
    --webkit-appearance:none;
    width:100%;
    height:10px;
    border-radius:8px;
    background: linear-gradient(to right, #6fe2ff, #d774e8);
    outline:none;
  }
  /* Chrome / Safari */
  #progresso::-webkit-slider-runnable-track {
    height: 10px;
    border-radius: 8px;
    background: linear-gradient(to right, #6fe2ff, #d774e8) 0/var(--pct,0%) no-repeat #333;
  }
  #progresso::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: #fff;
    cursor: pointer;
    box-shadow: 0 0 5px #000;
    margin-top: -3px;
  }

  /* Firefox */
  #progresso::-moz-range-progress {
    height: 10px;
    border-radius: 8px;
    background: linear-gradient(to right, #6fe2ff, #d774e8);
  }
  #progresso::-moz-range-track {
    height: 10px;
    border-radius: 8px;
    background: #333;
  }
  #progresso::-moz-range-thumb {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: #fff;
    cursor: pointer;
    box-shadow: 0 0 5px #000;
  }

  .Play,.Pause,.Stop,.botao-custom{
    display:inline-block;
    padding:10px 25px;
    margin-top:5px;
    border:none;
    border-radius:20px;
    font-weight:bold;
    cursor:pointer;
    background:#1dcdf0;
    box-shadow:0 3px 8px rgba(0,0,0,.2);
    transition:.2s;
  }
  .Play:hover,.Pause:hover,.Stop:hover,.botao-custom:hover{background:#19b0d6}

  #nome-arquivo{
    display: flex;
    margin-top:20px;
    color:#fff;
    font-weight:bold;
    font-size: 20px;
  }
  #titulo-container {
    display: flex;
    align-items: center;
    justify-content: space-between; /* coloca visualizer √† direita */
    gap: 10px;
  }

  #audio-visualizer {
    width: 50%;
    height: 100px;
    background: rgba(0,0,0,0.6);
    border-radius: 5px;
    border: 10px;
    border-color: #000;
  }
  #capa-video {
    max-width: 40%;   /* ocupar toda largura da container */
    margin-top: 10px;  /* separa√ß√£o do canvas */
    border-radius: 10px;
    display: none;
  }

  .Text {
    display: block;
  }
  #status{margin-top:5px;font-weight:bold}
  #mensagem{margin-top:10px;color:rgb(154,255,225);
  }
</style>
</head>
<body>
  <div class="container">
  <div id="titulo-container" style="display: flex; align-items: center; justify-content: space-between;">
    <div style="display: flex; flex-direction: column; gap: 5px;">
      <h2 class="Text">üéµ Player</h2>
      <label for="input-audio" class="botao-custom">üéµ Escolher m√∫sica</label>
      <input type="file" id="input-audio" accept="audio/*" style="display:none;">
    </div>
    <canvas id="audio-visualizer"></canvas>
  </div>  
    <img id="capa-video">
    <span id="nome-arquivo">Nenhum arquivo escolhido</span>
    <div id="barra-progresso">
      <input type="range" id="progresso" min="0" max="100" value="0">
    </div>
    <div id="status">Aguardando √°udio...</div>
    <button class="Play" onclick="playAudio()">‚ñ∂Ô∏è</button>
    <button class="Pause" onclick="pauseAudio()">‚è∏Ô∏è</button>
    <button class="Stop" onclick="stopAudio()">‚èπÔ∏è</button>
    <div id="mensagem"></div>
    <audio id="player" style="display: none;"></audio>
  </div>

  <script>
    const audio = document.getElementById("player");
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const analyser = ctx.createAnalyser();
    analyser.fftSize = 256;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);
    const canvas = document.getElementById("audio-visualizer");
    const ctxCanvas = canvas.getContext("2d");
    
    let sourceNode = null;
    let pausado = false;
    let encerrado = false;
    let tempoPausadoTotal = 0;
    let inicioPausa = 0;
    let inicioReproducao = 0;
    let intervalo = null;
    
    const progresso = document.getElementById("progresso");
    const status = document.getElementById("status");
    const mensagem = document.getElementById("mensagem");
    const nomeArq = document.getElementById("nome-arquivo");
    const input = document.getElementById("input-audio");
    const capa = document.getElementById("capa-video");
    
    // v√≠deo tempor√°rio para capturar o primeiro frame
    const videoTemp = document.createElement("video");
    videoTemp.muted = true;
    videoTemp.playsInline = true;
    
    input.addEventListener("change", e => {
        const file = e.target.files[0];
        if (!file) return;
    
        const nomeSemExt = file.name.replace(/\.[^/.]+$/, ""); // remove √∫ltima extens√£o
        nomeArq.textContent = nomeSemExt;
        encerrado = false;
        pausado = false;
    
        audio.pause();
        audio.src = URL.createObjectURL(file);
        audio.load();
    
        // Captura primeiro frame se for v√≠deo
        if (file.type.startsWith("video/")) {
            videoTemp.src = URL.createObjectURL(file);
            videoTemp.addEventListener("loadedmetadata", () => {
                videoTemp.currentTime = 0.5; // for√ßa o primeiro frame
            }, { once: true });

            videoTemp.addEventListener("seeked", () => {
                const c = document.createElement("canvas");
                c.width = videoTemp.videoWidth;
                c.height = videoTemp.videoHeight;
                const ctx2 = c.getContext("2d");
                ctx2.drawImage(videoTemp, 0, 0, c.width, c.height);
                capa.src = c.toDataURL("image/png");
                capa.style.display = "block";
            }, { once: true });
        } else {
            capa.style.display = "none";
        }
        if (!sourceNode) {
            sourceNode = ctx.createMediaElementSource(audio);
            sourceNode.connect(analyser);
            analyser.connect(ctx.destination);
        }
    
        audio.play();
        ctx.resume();
        inicioReproducao = performance.now();
        tempoPausadoTotal = 0;
        status.textContent = `Reproduzindo: ${file.name}`;
        mensagem.textContent = "Use as teclas: P = Pausar | C = Continuar | E = Encerrar";
    
        if (intervalo) clearInterval(intervalo);
        intervalo = setInterval(atualizarBarra, 100);
        desenharGrafico();
    });
    
    let arrastando = false;
    progresso.addEventListener("mousedown", () => arrastando = true);
    progresso.addEventListener("touchstart", () => arrastando = true);
    progresso.addEventListener("input", () => {
        const duracao = audio.duration || 1;
        const novoTempo = (progresso.value / 100) * duracao;
        if (arrastando) audio.currentTime = novoTempo;
    });
    progresso.addEventListener("mouseup", () => {
        arrastando = false;
        const duracao = audio.duration || 1;
        audio.currentTime = (progresso.value / 100) * duracao;
    });
    progresso.addEventListener("touchend", () => {
        arrastando = false;
        const duracao = audio.duration || 1;
        audio.currentTime = (progresso.value / 100) * duracao;
    });
    
    function atualizarBarra() {
        if (audio.paused || encerrado || arrastando) return;
        const tempoAtual = audio.currentTime;
        const duracao = audio.duration || 1;
        const pct = Math.min((tempoAtual / duracao) * 100, 100);
        progresso.value = pct;
        progresso.style.setProperty("--pct", pct + "%");
        status.textContent = `‚è± ${tempoAtual.toFixed(1)}s / ${duracao.toFixed(1)}s`;
    }
    
    function desenharGrafico() {
        requestAnimationFrame(desenharGrafico);
        analyser.getByteFrequencyData(dataArray);
        ctxCanvas.clearRect(0, 0, canvas.width, canvas.height);
        const barW = (canvas.width / bufferLength) * 2.5;
        let x = 0;
        for (let i = 0; i < bufferLength; i++) {
            const h = dataArray[i] * 0.3;
            ctxCanvas.fillStyle = `rgb(${h + 100}, 0, ${250 - h})`;
            ctxCanvas.fillRect(x, canvas.height - h, barW, h);
            x += barW + 2;
        }
    }
    
    function playAudio() {
        if (encerrado || audio.currentTime === 0) {
            audio.currentTime = 0;
            tempoPausadoTotal = 0;
            progresso.value = 0;
            inicioReproducao = performance.now();
        } else if (pausado) {
            tempoPausadoTotal += performance.now() - inicioPausa;
        }
        encerrado = false;
        pausado = false;
        ctx.resume();
        audio.play();
    }
    
    function pauseAudio() {
        if (!pausado && !audio.paused) {
            audio.pause();
            inicioPausa = performance.now();
            pausado = true;
        }
    }
    
    function stopAudio() {
        encerrado = true;
        audio.pause();
        audio.currentTime = 0;
        tempoPausadoTotal = 0;
        progresso.value = 0;
        mensagem.textContent = "";
        status.textContent = "M√∫sica encerrada.";
        progresso.style.setProperty("--pct","0%");
    }
    
    document.addEventListener("keydown", e => {
        if (e.key.toLowerCase() === "p") pauseAudio();
        if (e.key.toLowerCase() === "c") playAudio();
        if (e.key.toLowerCase() === "e") stopAudio();
    });
    
    audio.addEventListener("ended", () => {
        progresso.value = 0;
        status.textContent = "‚úÖ M√∫sica finalizada.";
        mensagem.textContent = "";
        encerrado = true;
        progresso.style.setProperty("--pct","0%");
    });
  </script> 
</body>
</html>
